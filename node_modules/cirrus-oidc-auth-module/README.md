# Cirrus Open ID Connect Authentication Flow
## PLEASE NOTE: This is now integrated into the hybrid module that can be found [here](https://github.com/EliLillyCo/CIRR_AUTH_MODULE)

This module contains the Open ID Connect flow logic for the Cirrus Authentication Module.

---

**Configuration instructions:**

1. Request a new federation connection by submitting a service request to the Identity Federation team. The ServiceNow request is located [here](https://lilly.service-now.com/ess/view_content_search.do?v=1&uri=com.glideapp.servicecatalog_cat_item_view.do%3Fv%3D1%26sysparm_id%3De2c504b00fbbf10028ed6509b1050e22%26sysparm_link_parent%3D47932b7135e7340014379b119de070df%26sysparm_catalog%3De0d08b13c3330100c8b837659bba8fb4&sysparm_document_key=sc_cat_item,e2c504b00fbbf10028ed6509b1050e22)

2. Provide the following information:
   - **Application Name:**  The name of the Heroku app to which the federation will be associated.
   - **Request Action:** Create new vendor hosted federation (application hosted by third party)
   - **Specify Vendor Name:** Heroku
   - **Select the Federation Protocol to be used:** OpenID Connect
   - **Provide:**
     * Primary contact
     * Secondary contact
     * Director contact appropriate to the project.
     * Requested implementation date.
   - **In the Additional Information section:**
     * request that the connection include the scopes `auth_web auth_webmfa`, and `openid`.
     * request that the callback URL be set to `<heroku-app-name>.herokuapp.com/auth/callback`

3. **You must then wait for the Identity Federation team to respond with your credentials before proceeding.**

4. **If you're developing locally, add the following environment variables to your `.env` file:**

   **Note:** Changing these from their preset values will break authentication.

   ```
   AUTH_TYPE=openid
   OPENID_CALLBACK=/auth/callback
   OPENID_ISSUER=https://federate-qa.xh1.lilly.com
   OPENID_TOKEN_URL=https://federate-qa.xh1.lilly.com/as/token.oauth2
   OPENID_USER_INFO_URL=https://federate-qa.xh1.lilly.com/idp/userinfo.openid
   ```

5. **Also add the following environment variables to your `.env` file. Some are based on the response from the Identity Federation team.**

   1. `OPENID_NONCE` = A secure, high entropy key. You can create a value [here](http://randomkeygen.com/)
   2. `OPENID_CLIENT_ID` = Provided by Identity Federation team.
   3. `OPENID_CLIENT_SECRET` = Provided by Identity Federation team.
   4. `COOKIE_SECRET`= A secure, high entropy key. You can create a value [here](http://randomkeygen.com/)
   5. `DISABLE_AUTH_LOGS` = set to `true` to disable auth logs.
   6. `AUTH_REQUIRED` = set to `true` to enable auth, `false` to disable auth
   
6. **Decide on the strength of authentication**

   This section focuses on configuring the `OPENID_SCOPE` environment variable. This step is **essential.**
   
   This flow supports 2 Factor Authentication if necessary (Authentication with a phone as well as a password):
      - `OPENID_SCOPE` = `auth_webmfa openid`
      
   Otherwise, you can use regular username and password SSO authentication with:
      - `OPENID_SCOPE` = `auth_web openid`



